on:
Â  push:
Â  Â  tags:
Â  Â  Â  - release/**

name: ğŸš€ Deploy website on push

jobs:
Â  set-env:
Â  Â  name: âš› Create Environment
Â  Â  runs-on: ubuntu-latest
Â  Â  steps:
Â  Â  - name: Extract version
Â  Â  Â  run: |
Â  Â  Â  Â  echo "BUILD_VERSION=${GITHUB_REF##*/}" >> $GITHUB_ENV
Â  Â  outputs:
Â  Â  Â  BUILD_VERSION: ${{env.BUILD_VERSION}}
      
Â  build-page:
Â  Â  name: ğŸ‰ Build and Deploy
Â  Â  runs-on: ubuntu-latest
Â  Â  needs: set-env
Â  Â  steps:
    
Â  Â  Â  - name: ğŸšš Get latest code
Â  Â  Â  Â  uses: actions/checkout@v3
	
Â  Â  Â  - name: âš™ï¸ Building web page
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  pip install mkdocs mkdocs-material
Â  Â  Â  Â  Â  sed -i 's/\${BUILD_VERSION}/${{needs.set-env.outputs.BUILD_VERSION}}/' mkdocs.yml
Â  Â  Â  Â  Â  mkdocs build --site-dir "public/"
	  
Â  Â  Â  - name: ğŸ’¾ Storing generated page for later usage
Â  Â  Â  Â  uses: actions/upload-artifact@v3
Â  Â  Â  Â  with:
Â  Â  Â  Â  Â  name: public-page
Â  Â  Â  Â  Â  path: public
Â  Â  Â  Â  Â  retention-days: 0
	  
Â  build-and-deploy:
Â  Â  Â  name: ğŸ‰ Deploy
Â  Â  Â  runs-on: ubuntu-latest
Â  Â  Â  needs: build-page
Â  Â  Â  steps:
Â  Â  Â  - name: Get Artefact
Â  Â  Â  Â  uses: actions/download-artifact@v3
Â  Â  Â  Â  with:
Â  Â  Â  Â  Â  name: public-page
Â  Â  Â  Â  Â  path: public

Â  Â  Â  - name: ğŸ“‚ Sync files
Â  Â  Â  Â  uses: SamKirkland/FTP-Deploy-Action@v4.3.4
Â  Â  Â  Â  with:
Â  Â  Â  Â  Â  server: winweb20.servicehoster.ch
Â  Â  Â  Â  Â  username: ${{ secrets.FTP_USER }}
Â  Â  Â  Â  Â  password: ${{ secrets.FTP_PASS }}
Â  Â  Â  Â  Â  local-dir: ./public/
Â  Â  Â  Â  Â  protocol: ftp
Â  Â  Â  Â  Â  port: 21
	  
Â  build-release:
Â  Â  name: âš™ï¸ Add Release
Â  Â  runs-on: ubuntu-latest
Â  Â  needs: [build-page, set-env]
Â  Â  permissions:
Â  Â  Â  contents: write
Â  Â  Â  actions: read
Â  Â  steps:
Â  Â  - uses: actions/checkout@v3
Â  Â  - uses: actions/download-artifact@v3
Â  Â  Â  name: Download Artefact
Â  Â  Â  id: download
Â  Â  Â  with:
Â  Â  Â  Â  name: public-page
Â  Â  Â  Â  path: public
Â  Â  - name: 'Echo download path'
Â  Â  Â  run: echo ${{steps.download.outputs.download-path}}
Â  Â  - uses: vimtor/action-zip@v1.1
Â  Â  Â  name: Create zip
Â  Â  Â  with:
Â  Â  Â  Â  files: ./public/
Â  Â  Â  Â  dest: DevOps-Demo-${{needs.set-env.outputs.BUILD_VERSION}}.zip
Â  Â  - uses: ncipollo/release-action@v1
Â  Â  Â  name: Create Release
Â  Â  Â  with:
Â  Â  Â  Â  artifacts: DevOps-Demo-${{needs.set-env.outputs.BUILD_VERSION}}.zip
